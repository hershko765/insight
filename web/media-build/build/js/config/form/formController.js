define(["app","admin/page/form/view","toastr","serializeForm","jqueryForm"],function(e,t,n){var r=Marionette.Controller.extend({initForm:function(t,n,r){var i=this,s=t.$el.find("form").serializeForm();return this.formView=t,this.options=r,n.get("id")&&(s.id=n.get("id")),$.each(s,function(e,t){t=="null"&&(s[e]=null)}),t.$el.find("input[type=checkbox]").each(function(e,t){s[$(t).prop("name")]=$(t).is(":checked")}),s=$.extend(n.toJSON()||{},s),_.bindAll(this,"onValidationError"),_.bindAll(this,"onSuccess"),r.fileForm&&!n.get("id")?t.$el.find("form").ajaxUpload({url:t.$el.find("form").prop("action"),success:i.onSuccess,error:function(e){var t={};t.responseJSON=JSON.parse(e.responseText),i.onValidationError("",t)}}):e.request(r.trigger,s,{success:i.onSuccess,error:i.onValidationError}),!1},onValidationError:function(e,t){n.error(lang("Form contain errors, please review the marked fields"));var r=this.formView.$el.find("form");r.find(".parsley-error-list").remove(),$.each(t.responseJSON.payload,function(e,t){r.find("[name="+e+"]:input").after($("<div></div>",{"class":"parsley-error-list"}).html(lang(t)))})},onSuccess:function(t){n.success(lang(this.options.success)),this.options.event&&e.vent.trigger(this.options.event),this.options.redirect&&e.navigate(this.options.redirect,{trigger:!0})},onClose:function(){}});return r});