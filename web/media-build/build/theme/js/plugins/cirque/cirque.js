(function(e,t,n){function o(){return!!i.createElement("canvas").getContext}function u(t,n){this.element=t,this.options=e.extend({},s,n,e(this.element).data()),this._defaults=s,this._name=r,this.init()}function a(e){return Math.PI/180*e-Math.PI/180*90}var r="cirque",i=t.document,s={value:0,radius:60,total:100,label:"percent",lineWidth:10,arcColor:"#0066CC",trackColor:"#EEEEEE",trackFill:"transparent",animate:!0,speed:20};u.prototype.init=function(){if(!o())return!1;var e,t,n,r,i,s;e=this.makeContainer(),t=this.makeCanvas(),n=this.makeTrack(),this.arcContext=t.get(0).getContext("2d"),this.trackContext=n.get(0).getContext("2d"),this.drawTrack(),r=this.makeValue(),this.options.animate?this.start():this.drawArc(a(this.options.value/this.options.total*360))},u.prototype.start=function(){var e=1,t=this,n=this.options.value/this.options.total,r=n/50,i=setInterval(function(){e>48&&clearInterval(i),e++,endAngle=a(r*e*360),t.drawArc(endAngle)},t.options.speed)},u.prototype.drawArc=function(e){this.arcContext.clearRect(0,0,this.options.radius*2,this.options.radius*2),this.arcContext.beginPath(),this.arcContext.strokeStyle=this.options.arcColor,this.arcContext.arc(this.options.radius,this.options.radius,this.options.radius-this.options.lineWidth,a(0),e),this.arcContext.lineWidth=this.options.lineWidth,this.arcContext.stroke()},e.fn.cirque=function(t){return this.each(function(){e.data(this,"plugin_"+r)||e.data(this,"plugin_"+r,new u(this,t))})},u.prototype.drawTrack=function(){this.trackContext.beginPath(),this.trackContext.strokeStyle=this.options.trackColor,this.trackContext.arc(this.options.radius,this.options.radius,this.options.radius-this.options.lineWidth,0,360),this.trackContext.lineWidth=this.options.lineWidth,this.trackContext.fillStyle=this.options.trackFill,this.trackContext.fill(),this.trackContext.stroke()},u.prototype.makeValue=function(){var t,n,r;return this.options.label=="percent"?(t=Math.round(this.options.value/this.options.total*100*Math.pow(10,2))/Math.pow(10,2),n=t+"%",r="percent"):(t=this.options.value,n=t+"/"+this.options.total,r="ratio"),e("<div>",{"class":"cirque-label"}).appendTo(this.element).html(n).addClass(r).css({width:this.options.radius*2}).css({height:this.options.radius*2}).css({"line-height":this.options.radius*2+"px"})},u.prototype.makeCanvas=function(){return e("<canvas/>",{}).appendTo(this.element).attr("width",this.options.radius*2).attr("height",this.options.radius*2).addClass("cirque-fill")},u.prototype.makeTrack=function(){return e("<canvas/>",{}).appendTo(this.element).attr("width",this.options.radius*2).attr("height",this.options.radius*2).addClass("cirque-track")},u.prototype.makeContainer=function(){return e(this.element).addClass("cirque-container").css({width:this.options.radius*2}).css({height:this.options.radius*2})}})(jQuery,window);